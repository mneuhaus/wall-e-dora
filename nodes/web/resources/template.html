<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script type="importmap">
      {
        "imports": {
          "@material/web/": "https://esm.run/@material/web/",
          "flatbuffers": "./node_modules/flatbuffers/flatbuffers.mjs"
        }
      }
    </script>
    <script type="module">
      import '@material/web/all.js';
      import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';
      document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Power Metrics</title>
    <style>
      body { margin:0; font-family: Roboto, sans-serif; }
      .status-bar { display: flex; align-items: center; justify-content: space-between; background-color: #6200ee; color: white; padding: 10px 16px; }
      .status-indicator { display: flex; align-items: center; }
      .status-indicator span { margin-left: 8px; }
      .metrics-table { margin: 16px 0; }
      table { width: 100%; border-collapse: collapse; }
      th, td { padding: 8px 12px; border-bottom: 1px solid #ddd; }
      .controls { margin: 16px 0; }
    </style>
  </head>
  <body>
    <header class="status-bar">
      <div class="status-indicator">
        <md-icon style="color: white;">power</md-icon>
        <span>Power Metrics</span>
      </div>
      <div id="connection-status">
        <md-icon id="status-icon" style="color: red;">cloud_off</md-icon>
      </div>
    </header>
    <main class="container" style="padding: 16px;">
      <section class="metrics-table">
        <table>
          <thead>
            <tr>
              <th>Metric</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Voltage</td><td id="voltage">-- V</td></tr>
            <tr><td>Current</td><td id="current">-- A</td></tr>
            <tr><td>Power</td><td id="power">-- W</td></tr>
            <tr><td>SoC</td><td id="soc">-- %</td></tr>
            <tr><td>Runtime</td><td id="runtime">-- s</td></tr>
          </tbody>
        </table>
      </section>
      <section class="controls">
        <md-outlined-button onclick="sendButton()">Press me</md-outlined-button>
        <div style="margin-top: 16px;">
          <label for="slider">Adjust value:</label>
          <md-slider id="slider" min="0" max="100" value="50" discrete onchange="sendSlider(this.value)"></md-slider>
        </div>
        <div style="margin-top: 16px;">
          <label for="volume">Volume:</label>
          <md-slider id="volume" min="0" max="1" value="1" step="0.01" discrete onchange="sendVolume(this.value)"></md-slider>
        </div>
      </section>
      <section id="sound-list">
        <h2>Available Sounds</h2>
        <md-list id="sounds"></md-list>
      </section>
    </main>
    <script type="module">
      import { Node } from './js/Node.js';
      const node = new Node();

      function updateMetrics(metrics) {
        document.getElementById('voltage').innerText = metrics.voltage + " V";
        document.getElementById('current').innerText = metrics.current + " A";
        document.getElementById('power').innerText = metrics.power + " W";
        document.getElementById('soc').innerText = metrics.soc + " %";
        document.getElementById('runtime').innerText = metrics.runtime + " s";
      }
      
      function updateUI(data) {
        if (data.action) {
          data = data.value;
        }
        updateMetrics(data);
        updateSoundList(data.available_sounds);
        if (data.volume !== undefined) {
          document.getElementById('volume').value = data.volume;
        }
      }

      node.next((event) => {
        if (event.id === 'audio/available_sounds') {
          updateSoundList(event.value);
        } else if (event.id === 'power/voltage') {
          document.getElementById('voltage').innerText = event.value + " V";
        } else if (event.id === 'power/current') {
          document.getElementById('current').innerText = event.value + " A";
        } else if (event.id === 'power/power') {
          document.getElementById('power').innerText = event.value + " W";
        } else if (event.id === 'power/soc') {
          document.getElementById('soc').innerText = event.value + " %";
        } else if (event.id === 'power/runtime') {
          document.getElementById('runtime').innerText = event.value + " s";
        } else if (event.id === 'power/shutdown') {
          console.log('Shutdown event received:', event.value);
        }
      })

    </script>
  </body>
</html>
